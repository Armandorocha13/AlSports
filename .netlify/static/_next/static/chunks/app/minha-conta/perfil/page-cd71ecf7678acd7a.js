(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[112],{7363:function(e,r,t){Promise.resolve().then(t.bind(t,5705))},5705:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return x}});var a=t(7437),n=t(2265),s=t(9376),l=t(7648),o=t(2660),i=t(2489),c=t(401),u=t(9345),d=t(2369),m=t(3041),f=t(3229),h=t(6281),p=t(9203),g=t(1384);function x(){let e=(0,s.useRouter)(),{user:r,profile:t,loading:x,updateProfile:y}=(0,h.a)(),[v,b]=(0,n.useState)(!1),[j,N]=(0,n.useState)(""),[w,_]=(0,n.useState)(""),[S,k]=(0,n.useState)({full_name:"",phone:"",cpf:""});(0,p.e)(),(0,n.useEffect)(()=>{if(!x&&!r){e.push("/auth/login?redirectTo=/minha-conta/perfil");return}t&&k({full_name:t.full_name||"",phone:t.phone||"",cpf:t.cpf||""})},[r,t,x]);let C=e=>{let{name:r,value:t}=e.target,a=t;"phone"===r&&(a=(0,g.CN)(t)),k(e=>({...e,[r]:a}))},E=async e=>{if(e.preventDefault(),b(!0),N(""),_(""),!S.full_name.trim()){N("Nome completo \xe9 obrigat\xf3rio"),b(!1);return}if(S.phone&&!(0,g.a$)(S.phone)){N("Telefone inv\xe1lido"),b(!1);return}try{let{error:e}=await y({full_name:S.full_name,phone:S.phone,cpf:S.cpf});if(e){N(e.message||"Erro ao atualizar perfil"),b(!1);return}_("Perfil atualizado com sucesso!")}catch(e){console.error("Erro ao atualizar perfil:",e),N("Erro interno do servidor")}finally{b(!1)}};return x?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})}):r?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,a.jsxs)("div",{className:"max-w-2xl mx-auto px-4",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("div",{className:"flex items-center mb-4",children:(0,a.jsxs)(l.default,{href:"/minha-conta",className:"flex items-center text-gray-600 hover:text-gray-900 mr-4",children:[(0,a.jsx)(o.Z,{className:"h-5 w-5 mr-1"}),"Voltar"]})}),(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Meu Perfil"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Atualize suas informa\xe7\xf5es pessoais"})]}),j&&(0,a.jsx)("div",{className:"mb-6 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-md",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(i.Z,{className:"h-5 w-5 mr-2"}),j]})}),w&&(0,a.jsx)("div",{className:"mb-6 bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-md",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(c.Z,{className:"h-5 w-5 mr-2"}),w]})}),(0,a.jsx)("div",{className:"bg-white rounded-lg shadow p-6",children:(0,a.jsxs)("form",{onSubmit:E,className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,a.jsx)(u.Z,{className:"h-5 w-5 text-gray-400"})}),(0,a.jsx)("input",{type:"email",id:"email",value:r.email||"",className:"w-full pl-10 pr-3 py-2 bg-gray-100 border border-gray-300 rounded-md text-gray-500 cursor-not-allowed",disabled:!0})]}),(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"O email n\xe3o pode ser alterado"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"full_name",className:"block text-sm font-medium text-gray-700 mb-2",children:"Nome Completo *"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,a.jsx)(d.Z,{className:"h-5 w-5 text-gray-400"})}),(0,a.jsx)("input",{type:"text",id:"full_name",name:"full_name",value:S.full_name,onChange:C,className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500",placeholder:"Seu nome completo",required:!0})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-700 mb-2",children:"Telefone"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,a.jsx)(m.Z,{className:"h-5 w-5 text-gray-400"})}),(0,a.jsx)("input",{type:"tel",id:"phone",name:"phone",value:S.phone,onChange:C,maxLength:15,className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500",placeholder:"(11) 99999-9999"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"cpf",className:"block text-sm font-medium text-gray-700 mb-2",children:"CPF"}),(0,a.jsx)("input",{type:"text",id:"cpf",name:"cpf",value:S.cpf,onChange:C,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500",placeholder:"000.000.000-00",maxLength:14})]}),(0,a.jsxs)("div",{className:"border-t border-gray-200 pt-6",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Informa\xe7\xf5es da Conta"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium text-gray-700",children:"Membro desde:"}),(0,a.jsx)("p",{className:"text-gray-900",children:new Date(r.created_at).toLocaleDateString("pt-BR")})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium text-gray-700",children:"\xdaltima atualiza\xe7\xe3o:"}),(0,a.jsx)("p",{className:"text-gray-900",children:(null==t?void 0:t.updated_at)?new Date(t.updated_at).toLocaleDateString("pt-BR"):"Nunca"})]})]})]}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsx)("button",{type:"submit",disabled:v,className:"bg-primary-600 text-white px-6 py-2 rounded-md hover:bg-primary-700 transition-colors duration-200 flex items-center disabled:opacity-50 disabled:cursor-not-allowed",children:v?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Salvando..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(f.Z,{className:"h-4 w-4 mr-2"}),"Salvar Altera\xe7\xf5es"]})})})]})})]})}):null}},6281:function(e,r,t){"use strict";t.d(r,{AuthProvider:function(){return o},a:function(){return i}});var a=t(7437),n=t(2265),s=t(9203);let l=(0,n.createContext)(void 0);function o(e){let{children:r}=e,[t,o]=(0,n.useState)(null),[i,c]=(0,n.useState)(null),[u,d]=(0,n.useState)(null),[m,f]=(0,n.useState)(!0),h=(0,s.e)();(0,n.useEffect)(()=>{(async()=>{var e;let{data:{session:r}}=await h.auth.getSession();d(r),o(null!==(e=null==r?void 0:r.user)&&void 0!==e?e:null),(null==r?void 0:r.user)&&await p(r.user.id),f(!1)})();let{data:{subscription:e}}=h.auth.onAuthStateChange(async(e,r)=>{var t;d(r),o(null!==(t=null==r?void 0:r.user)&&void 0!==t?t:null),(null==r?void 0:r.user)?await p(r.user.id):c(null),f(!1)});return()=>e.unsubscribe()},[]);let p=async e=>{try{let{data:r,error:a}=await h.from("profiles").select("*").eq("id",e).single();if(a){console.error("Erro ao buscar perfil:",a),console.log("Tentando criar perfil para usu\xe1rio:",e);let{data:r,error:n}=await h.from("profiles").insert({id:e,email:(null==t?void 0:t.email)||"usuario@exemplo.com",full_name:"Usu\xe1rio",user_type:"cliente"}).select().single();if(n){console.error("Erro ao criar perfil:",n);let r={id:e,email:(null==t?void 0:t.email)||"usuario@exemplo.com",full_name:"Usu\xe1rio",phone:null,cpf:null,birth_date:null,user_type:"cliente",avatar_url:null,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};c(r)}else console.log("Perfil criado com sucesso:",r),c(r)}else console.log("Perfil encontrado:",r),c(r);let{data:n,error:s}=await h.from("user_roles").select("role").eq("user_id",e);if(s){console.error("Erro ao buscar roles:",s),c(r);return}let l=r.user_type||"cliente";if(n&&n.length>0){let e=n.map(e=>e.role);e.includes("admin")?l="admin":e.includes("vendedor")&&(l="vendedor")}"00000000-0000-0000-0000-000000000001"===e&&(l="admin",console.log("\uD83D\uDD27 Usu\xe1rio admin detectado via fallback"));let o={...r,user_type:l};c(o)}catch(r){console.error("Erro ao buscar perfil:",r),c({id:e,email:"usuario@exemplo.com",full_name:"Usu\xe1rio",phone:null,cpf:null,birth_date:null,user_type:"cliente",avatar_url:null,created_at:new Date().toISOString(),updated_at:new Date().toISOString()})}},g=async(e,r,t)=>{try{let{data:a}=await h.auth.getUser(),{data:n}=await h.from("profiles").select("email").eq("email",e).single();if(n)return{error:{message:"Este email j\xe1 est\xe1 cadastrado"}};if(t.cpf){let{data:e}=await h.from("profiles").select("cpf").eq("cpf",t.cpf).single();if(e)return{error:{message:"Este CPF j\xe1 est\xe1 cadastrado"}}}console.log("Criando usu\xe1rio no Supabase Auth...");let{data:s,error:l}=await h.auth.signUp({email:e,password:r,options:{data:{full_name:t.full_name,phone:t.phone}}});if(console.log("Resultado da cria\xe7\xe3o do usu\xe1rio:",{data:s,error:l}),l){let e=l.message;return l.message.includes("already registered")||l.message.includes("User already registered")?e="Este email j\xe1 est\xe1 cadastrado":l.message.includes("Invalid email")?e="Email inv\xe1lido":l.message.includes("Password should be at least")?e="A senha deve ter pelo menos 6 caracteres":l.message.includes("Unable to validate email address")&&(e="N\xe3o foi poss\xedvel validar o email"),{error:{...l,message:e}}}if(s.user){console.log("Criando perfil para usu\xe1rio:",s.user.id),console.log("Dados do perfil:",{id:s.user.id,email:s.user.email,full_name:t.full_name,phone:t.phone,cpf:t.cpf,birth_date:t.birth_date,user_type:"cliente"});let{data:e,error:r}=await h.from("profiles").insert({id:s.user.id,email:s.user.email,full_name:t.full_name,phone:t.phone,cpf:t.cpf,birth_date:t.birth_date,user_type:"cliente"}).select();if(r)return console.error("Erro ao criar perfil:",r),console.error("Detalhes do erro:",{code:r.code,message:r.message,details:r.details,hint:r.hint}),await h.auth.admin.deleteUser(s.user.id),{error:{message:"Erro ao criar perfil do usu\xe1rio"}};console.log("Perfil criado com sucesso:",e)}return console.log("Cadastro finalizado com sucesso, retornando sucesso"),{error:null}}catch(e){return console.error("Erro no signUp:",e),{error:{message:"Erro interno do servidor"}}}},x=async(e,r)=>{try{var t;console.log("Tentando fazer login para:",e);let{data:a,error:n}=await h.auth.signInWithPassword({email:e,password:r});if(n)return console.error("Erro no login:",n),{error:n};return console.log("Login realizado com sucesso:",null===(t=a.user)||void 0===t?void 0:t.email),{error:null}}catch(e){return console.error("Erro no catch do login:",e),{error:e}}},y=async()=>{try{await h.auth.signOut()}catch(e){console.error("Erro ao fazer logout:",e)}},v=async e=>{if(!t)return{error:Error("Usu\xe1rio n\xe3o autenticado")};try{let{error:r}=await h.from("profiles").update(e).eq("id",t.id);if(r)return{error:r};return c(r=>r?{...r,...e}:null),{error:null}}catch(e){return{error:e}}};return(0,a.jsx)(l.Provider,{value:{user:t,profile:i,session:u,loading:m,signUp:g,signIn:x,signOut:y,updateProfile:v},children:r})}function i(){let e=(0,n.useContext)(l);if(void 0===e)throw Error("useAuth deve ser usado dentro de um AuthProvider");return e}},9203:function(e,r,t){"use strict";t.d(r,{e:function(){return n}});var a=t(7272);function n(){return(0,a.createBrowserClient)("https://nzrzgtwhgousnnvxjyhf.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im56cnpndHdoZ291c25udnhqeWhmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk2ODc1OTAsImV4cCI6MjA3NTI2MzU5MH0.RxeZfgwMfUAr6iGDCb4gsB_lDLYYgyWj70hCaC3CE7o")}},1384:function(e,r,t){"use strict";t.d(r,{CN:function(){return s},Cz:function(){return n},a$:function(){return i},oH:function(){return l},pM:function(){return a},uo:function(){return o}});let a=e=>{if(11!==(e=e.replace(/[^\d]/g,"")).length||/^(\d)\1{10}$/.test(e))return!1;let r=0;for(let t=0;t<9;t++)r+=parseInt(e.charAt(t))*(10-t);let t=10*r%11;if((10===t||11===t)&&(t=0),t!==parseInt(e.charAt(9)))return!1;r=0;for(let t=0;t<10;t++)r+=parseInt(e.charAt(t))*(11-t);return(10==(t=10*r%11)||11===t)&&(t=0),t===parseInt(e.charAt(10))},n=e=>{let r=e.replace(/[^\d]/g,"");return r.length<=3?r:r.length<=6?"".concat(r.slice(0,3),".").concat(r.slice(3)):r.length<=9?"".concat(r.slice(0,3),".").concat(r.slice(3,6),".").concat(r.slice(6)):"".concat(r.slice(0,3),".").concat(r.slice(3,6),".").concat(r.slice(6,9),"-").concat(r.slice(9,11))},s=e=>{let r=e.replace(/[^\d]/g,"");return r.length<=2?r:r.length<=7?"(".concat(r.slice(0,2),") ").concat(r.slice(2)):"(".concat(r.slice(0,2),") ").concat(r.slice(2,7),"-").concat(r.slice(7,11))},l=e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),o=e=>e.length<6?{isValid:!1,message:"A senha deve ter pelo menos 6 caracteres"}:e.length>128?{isValid:!1,message:"A senha deve ter no m\xe1ximo 128 caracteres"}:{isValid:!0},i=e=>{let r=e.replace(/[^\d]/g,"");return 10===r.length||11===r.length}},2660:function(e,r,t){"use strict";t.d(r,{Z:function(){return a}});let a=(0,t(9763).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},401:function(e,r,t){"use strict";t.d(r,{Z:function(){return a}});let a=(0,t(9763).Z)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]])},9345:function(e,r,t){"use strict";t.d(r,{Z:function(){return a}});let a=(0,t(9763).Z)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]])},3041:function(e,r,t){"use strict";t.d(r,{Z:function(){return a}});let a=(0,t(9763).Z)("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]])},3229:function(e,r,t){"use strict";t.d(r,{Z:function(){return a}});let a=(0,t(9763).Z)("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]])},2369:function(e,r,t){"use strict";t.d(r,{Z:function(){return a}});let a=(0,t(9763).Z)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},2489:function(e,r,t){"use strict";t.d(r,{Z:function(){return a}});let a=(0,t(9763).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},7648:function(e,r,t){"use strict";t.d(r,{default:function(){return n.a}});var a=t(2972),n=t.n(a)},9376:function(e,r,t){"use strict";var a=t(5475);t.o(a,"notFound")&&t.d(r,{notFound:function(){return a.notFound}}),t.o(a,"useRouter")&&t.d(r,{useRouter:function(){return a.useRouter}}),t.o(a,"useSearchParams")&&t.d(r,{useSearchParams:function(){return a.useSearchParams}})}},function(e){e.O(0,[972,99,971,117,744],function(){return e(e.s=7363)}),_N_E=e.O()}]);