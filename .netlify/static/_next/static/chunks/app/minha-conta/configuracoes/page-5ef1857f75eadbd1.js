(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[241],{3861:function(e,r,a){Promise.resolve().then(a.bind(a,7868))},7868:function(e,r,a){"use strict";a.r(r),a.d(r,{default:function(){return y}});var s=a(7437),t=a(2265),n=a(9376),o=a(7648),l=a(2660),i=a(2489),d=a(401),c=a(8906);let u=(0,a(9763).Z)("Key",[["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["path",{d:"m15.5 7.5 3 3L22 7l-3-3",key:"1rn1fs"}]]);var m=a(7769),h=a(2208),f=a(3229),x=a(8728),p=a(6281),g=a(9203);function y(){let e=(0,n.useRouter)(),{user:r,loading:a,signOut:y}=(0,p.a)(),[b,v]=(0,t.useState)(!1),[w,j]=(0,t.useState)(""),[N,S]=(0,t.useState)(""),[P,k]=(0,t.useState)(!1),[C,_]=(0,t.useState)(!1),[E,Z]=(0,t.useState)(!1),[I,z]=(0,t.useState)(!1),[A,M]=(0,t.useState)({currentPassword:"",newPassword:"",confirmPassword:""}),D=(0,g.e)();(0,t.useEffect)(()=>{if(!a&&!r){e.push("/auth/login?redirectTo=/minha-conta/configuracoes");return}},[r,a]);let O=e=>{let{name:r,value:a}=e.target;M(e=>({...e,[r]:a}))},U=async e=>{if(e.preventDefault(),v(!0),j(""),S(""),!A.currentPassword){j("Senha atual \xe9 obrigat\xf3ria"),v(!1);return}if(!A.newPassword){j("Nova senha \xe9 obrigat\xf3ria"),v(!1);return}if(A.newPassword.length<6){j("A nova senha deve ter pelo menos 6 caracteres"),v(!1);return}if(A.newPassword!==A.confirmPassword){j("As senhas n\xe3o coincidem"),v(!1);return}try{let{error:e}=await D.auth.signInWithPassword({email:r.email,password:A.currentPassword});if(e){j("Senha atual incorreta"),v(!1);return}let{error:a}=await D.auth.updateUser({password:A.newPassword});if(a){j("Erro ao atualizar senha"),v(!1);return}S("Senha atualizada com sucesso!"),M({currentPassword:"",newPassword:"",confirmPassword:""}),k(!1)}catch(e){console.error("Erro ao atualizar senha:",e),j("Erro interno do servidor")}finally{v(!1)}},q=async()=>{if(confirm("Tem certeza que deseja excluir sua conta? Esta a\xe7\xe3o n\xe3o pode ser desfeita.")&&confirm('ATEN\xc7\xc3O: Todos os seus dados ser\xe3o perdidos permanentemente. Digite "CONFIRMAR" para continuar.')){v(!0),j("");try{j("Para excluir sua conta, entre em contato com o suporte.")}catch(e){console.error("Erro ao excluir conta:",e),j("Erro interno do servidor")}finally{v(!1)}}};return a?(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})}):r?(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,s.jsxs)("div",{className:"max-w-2xl mx-auto px-4",children:[(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsx)("div",{className:"flex items-center mb-4",children:(0,s.jsxs)(o.default,{href:"/minha-conta",className:"flex items-center text-gray-600 hover:text-gray-900 mr-4",children:[(0,s.jsx)(l.Z,{className:"h-5 w-5 mr-1"}),"Voltar"]})}),(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Configura\xe7\xf5es"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Gerencie as configura\xe7\xf5es da sua conta"})]}),w&&(0,s.jsx)("div",{className:"mb-6 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-md",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(i.Z,{className:"h-5 w-5 mr-2"}),w]})}),N&&(0,s.jsx)("div",{className:"mb-6 bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-md",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(d.Z,{className:"h-5 w-5 mr-2"}),N]})}),(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,s.jsxs)("div",{className:"flex items-center mb-6",children:[(0,s.jsx)("div",{className:"p-3 bg-blue-100 rounded-lg mr-4",children:(0,s.jsx)(c.Z,{className:"h-6 w-6 text-blue-600"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Seguran\xe7a"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Gerencie a seguran\xe7a da sua conta"})]})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(u,{className:"h-5 w-5 text-gray-400 mr-3"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-medium text-gray-900",children:"Senha"}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"Atualize sua senha de acesso"})]})]}),(0,s.jsx)("button",{onClick:()=>k(!P),className:"text-primary-600 hover:text-primary-700 text-sm font-medium",children:P?"Cancelar":"Alterar"})]}),P&&(0,s.jsx)("form",{onSubmit:U,className:"p-4 border border-gray-200 rounded-lg bg-gray-50",children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"currentPassword",className:"block text-sm font-medium text-gray-700 mb-2",children:"Senha Atual"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("input",{type:C?"text":"password",id:"currentPassword",name:"currentPassword",value:A.currentPassword,onChange:O,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500 pr-10",required:!0}),(0,s.jsx)("button",{type:"button",className:"absolute inset-y-0 right-0 pr-3 flex items-center",onClick:()=>_(!C),children:C?(0,s.jsx)(m.Z,{className:"h-4 w-4 text-gray-400"}):(0,s.jsx)(h.Z,{className:"h-4 w-4 text-gray-400"})})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"newPassword",className:"block text-sm font-medium text-gray-700 mb-2",children:"Nova Senha"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("input",{type:E?"text":"password",id:"newPassword",name:"newPassword",value:A.newPassword,onChange:O,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500 pr-10",required:!0}),(0,s.jsx)("button",{type:"button",className:"absolute inset-y-0 right-0 pr-3 flex items-center",onClick:()=>Z(!E),children:E?(0,s.jsx)(m.Z,{className:"h-4 w-4 text-gray-400"}):(0,s.jsx)(h.Z,{className:"h-4 w-4 text-gray-400"})})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700 mb-2",children:"Confirmar Nova Senha"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("input",{type:I?"text":"password",id:"confirmPassword",name:"confirmPassword",value:A.confirmPassword,onChange:O,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500 pr-10",required:!0}),(0,s.jsx)("button",{type:"button",className:"absolute inset-y-0 right-0 pr-3 flex items-center",onClick:()=>z(!I),children:I?(0,s.jsx)(m.Z,{className:"h-4 w-4 text-gray-400"}):(0,s.jsx)(h.Z,{className:"h-4 w-4 text-gray-400"})})]})]}),(0,s.jsxs)("div",{className:"flex justify-end space-x-4",children:[(0,s.jsx)("button",{type:"button",onClick:()=>{k(!1),M({currentPassword:"",newPassword:"",confirmPassword:""})},className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 transition-colors duration-200",children:"Cancelar"}),(0,s.jsx)("button",{type:"submit",disabled:b,className:"px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700 transition-colors duration-200 flex items-center disabled:opacity-50 disabled:cursor-not-allowed",children:b?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Salvando..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(f.Z,{className:"h-4 w-4 mr-2"}),"Salvar"]})})]})]})})]})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,s.jsxs)("div",{className:"flex items-center mb-6",children:[(0,s.jsx)("div",{className:"p-3 bg-red-100 rounded-lg mr-4",children:(0,s.jsx)(x.Z,{className:"h-6 w-6 text-red-600"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"A\xe7\xf5es da Conta"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Gerenciar sua conta"})]})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-medium text-gray-900",children:"Sair da Conta"}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"Fa\xe7a logout da sua conta"})]}),(0,s.jsx)("button",{onClick:y,className:"text-red-600 hover:text-red-700 text-sm font-medium",children:"Sair"})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between p-4 border border-red-200 rounded-lg bg-red-50",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-medium text-red-900",children:"Excluir Conta"}),(0,s.jsx)("p",{className:"text-sm text-red-700",children:"Exclua permanentemente sua conta e todos os dados"})]}),(0,s.jsx)("button",{onClick:q,disabled:b,className:"text-red-600 hover:text-red-700 text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:"Excluir"})]})]})]})]})]})}):null}},6281:function(e,r,a){"use strict";a.d(r,{AuthProvider:function(){return l},a:function(){return i}});var s=a(7437),t=a(2265),n=a(9203);let o=(0,t.createContext)(void 0);function l(e){let{children:r}=e,[a,l]=(0,t.useState)(null),[i,d]=(0,t.useState)(null),[c,u]=(0,t.useState)(null),[m,h]=(0,t.useState)(!0),f=(0,n.e)();(0,t.useEffect)(()=>{(async()=>{var e;let{data:{session:r}}=await f.auth.getSession();u(r),l(null!==(e=null==r?void 0:r.user)&&void 0!==e?e:null),(null==r?void 0:r.user)&&await x(r.user.id),h(!1)})();let{data:{subscription:e}}=f.auth.onAuthStateChange(async(e,r)=>{var a;u(r),l(null!==(a=null==r?void 0:r.user)&&void 0!==a?a:null),(null==r?void 0:r.user)?await x(r.user.id):d(null),h(!1)});return()=>e.unsubscribe()},[]);let x=async e=>{try{let{data:r,error:s}=await f.from("profiles").select("*").eq("id",e).single();if(s){console.error("Erro ao buscar perfil:",s),console.log("Tentando criar perfil para usu\xe1rio:",e);let{data:r,error:t}=await f.from("profiles").insert({id:e,email:(null==a?void 0:a.email)||"usuario@exemplo.com",full_name:"Usu\xe1rio",user_type:"cliente"}).select().single();if(t){console.error("Erro ao criar perfil:",t);let r={id:e,email:(null==a?void 0:a.email)||"usuario@exemplo.com",full_name:"Usu\xe1rio",phone:null,cpf:null,birth_date:null,user_type:"cliente",avatar_url:null,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};d(r)}else console.log("Perfil criado com sucesso:",r),d(r)}else console.log("Perfil encontrado:",r),d(r);let{data:t,error:n}=await f.from("user_roles").select("role").eq("user_id",e);if(n){console.error("Erro ao buscar roles:",n),d(r);return}let o=r.user_type||"cliente";if(t&&t.length>0){let e=t.map(e=>e.role);e.includes("admin")?o="admin":e.includes("vendedor")&&(o="vendedor")}"00000000-0000-0000-0000-000000000001"===e&&(o="admin",console.log("\uD83D\uDD27 Usu\xe1rio admin detectado via fallback"));let l={...r,user_type:o};d(l)}catch(r){console.error("Erro ao buscar perfil:",r),d({id:e,email:"usuario@exemplo.com",full_name:"Usu\xe1rio",phone:null,cpf:null,birth_date:null,user_type:"cliente",avatar_url:null,created_at:new Date().toISOString(),updated_at:new Date().toISOString()})}},p=async(e,r,a)=>{try{let{data:s}=await f.auth.getUser(),{data:t}=await f.from("profiles").select("email").eq("email",e).single();if(t)return{error:{message:"Este email j\xe1 est\xe1 cadastrado"}};if(a.cpf){let{data:e}=await f.from("profiles").select("cpf").eq("cpf",a.cpf).single();if(e)return{error:{message:"Este CPF j\xe1 est\xe1 cadastrado"}}}console.log("Criando usu\xe1rio no Supabase Auth...");let{data:n,error:o}=await f.auth.signUp({email:e,password:r,options:{data:{full_name:a.full_name,phone:a.phone}}});if(console.log("Resultado da cria\xe7\xe3o do usu\xe1rio:",{data:n,error:o}),o){let e=o.message;return o.message.includes("already registered")||o.message.includes("User already registered")?e="Este email j\xe1 est\xe1 cadastrado":o.message.includes("Invalid email")?e="Email inv\xe1lido":o.message.includes("Password should be at least")?e="A senha deve ter pelo menos 6 caracteres":o.message.includes("Unable to validate email address")&&(e="N\xe3o foi poss\xedvel validar o email"),{error:{...o,message:e}}}if(n.user){console.log("Criando perfil para usu\xe1rio:",n.user.id),console.log("Dados do perfil:",{id:n.user.id,email:n.user.email,full_name:a.full_name,phone:a.phone,cpf:a.cpf,birth_date:a.birth_date,user_type:"cliente"});let{data:e,error:r}=await f.from("profiles").insert({id:n.user.id,email:n.user.email,full_name:a.full_name,phone:a.phone,cpf:a.cpf,birth_date:a.birth_date,user_type:"cliente"}).select();if(r)return console.error("Erro ao criar perfil:",r),console.error("Detalhes do erro:",{code:r.code,message:r.message,details:r.details,hint:r.hint}),await f.auth.admin.deleteUser(n.user.id),{error:{message:"Erro ao criar perfil do usu\xe1rio"}};console.log("Perfil criado com sucesso:",e)}return console.log("Cadastro finalizado com sucesso, retornando sucesso"),{error:null}}catch(e){return console.error("Erro no signUp:",e),{error:{message:"Erro interno do servidor"}}}},g=async(e,r)=>{try{var a;console.log("Tentando fazer login para:",e);let{data:s,error:t}=await f.auth.signInWithPassword({email:e,password:r});if(t)return console.error("Erro no login:",t),{error:t};return console.log("Login realizado com sucesso:",null===(a=s.user)||void 0===a?void 0:a.email),{error:null}}catch(e){return console.error("Erro no catch do login:",e),{error:e}}},y=async()=>{try{await f.auth.signOut()}catch(e){console.error("Erro ao fazer logout:",e)}},b=async e=>{if(!a)return{error:Error("Usu\xe1rio n\xe3o autenticado")};try{let{error:r}=await f.from("profiles").update(e).eq("id",a.id);if(r)return{error:r};return d(r=>r?{...r,...e}:null),{error:null}}catch(e){return{error:e}}};return(0,s.jsx)(o.Provider,{value:{user:a,profile:i,session:c,loading:m,signUp:p,signIn:g,signOut:y,updateProfile:b},children:r})}function i(){let e=(0,t.useContext)(o);if(void 0===e)throw Error("useAuth deve ser usado dentro de um AuthProvider");return e}},9203:function(e,r,a){"use strict";a.d(r,{e:function(){return t}});var s=a(7272);function t(){return(0,s.createBrowserClient)("https://nzrzgtwhgousnnvxjyhf.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im56cnpndHdoZ291c25udnhqeWhmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk2ODc1OTAsImV4cCI6MjA3NTI2MzU5MH0.RxeZfgwMfUAr6iGDCb4gsB_lDLYYgyWj70hCaC3CE7o")}},2660:function(e,r,a){"use strict";a.d(r,{Z:function(){return s}});let s=(0,a(9763).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},401:function(e,r,a){"use strict";a.d(r,{Z:function(){return s}});let s=(0,a(9763).Z)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]])},7769:function(e,r,a){"use strict";a.d(r,{Z:function(){return s}});let s=(0,a(9763).Z)("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]])},2208:function(e,r,a){"use strict";a.d(r,{Z:function(){return s}});let s=(0,a(9763).Z)("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},3229:function(e,r,a){"use strict";a.d(r,{Z:function(){return s}});let s=(0,a(9763).Z)("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]])},8728:function(e,r,a){"use strict";a.d(r,{Z:function(){return s}});let s=(0,a(9763).Z)("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},8906:function(e,r,a){"use strict";a.d(r,{Z:function(){return s}});let s=(0,a(9763).Z)("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]])},2489:function(e,r,a){"use strict";a.d(r,{Z:function(){return s}});let s=(0,a(9763).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},7648:function(e,r,a){"use strict";a.d(r,{default:function(){return t.a}});var s=a(2972),t=a.n(s)},9376:function(e,r,a){"use strict";var s=a(5475);a.o(s,"notFound")&&a.d(r,{notFound:function(){return s.notFound}}),a.o(s,"useRouter")&&a.d(r,{useRouter:function(){return s.useRouter}}),a.o(s,"useSearchParams")&&a.d(r,{useSearchParams:function(){return s.useSearchParams}})}},function(e){e.O(0,[972,99,971,117,744],function(){return e(e.s=3861)}),_N_E=e.O()}]);