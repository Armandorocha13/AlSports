(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[454],{4326:function(e,r,t){Promise.resolve().then(t.bind(t,1998))},1998:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return x}});var a=t(7437),s=t(2265),o=t(9376),n=t(7648),l=t(2369),i=t(9345),c=t(3041),u=t(6337),d=t(7769),m=t(2208),f=t(2660),p=t(6281),h=t(1384);function x(){let[e,r]=(0,s.useState)({fullName:"",email:"",phone:"",cpf:"",password:"",confirmPassword:""}),[t,x]=(0,s.useState)(!1),[g,y]=(0,s.useState)(!1),[v,b]=(0,s.useState)(!1),[w,j]=(0,s.useState)(!1),[N,C]=(0,s.useState)(""),{signUp:k}=(0,p.a)(),_=(0,o.useRouter)(),E=e=>{let{name:t,value:a}=e.target,s=a;"cpf"===t?s=(0,h.Cz)(a):"phone"===t&&(s=(0,h.CN)(a)),r(e=>({...e,[t]:s}))},S=async r=>{if(r.preventDefault(),b(!0),C(""),!e.fullName.trim()){C("Nome completo \xe9 obrigat\xf3rio"),b(!1);return}if(!e.email.trim()){C("Email \xe9 obrigat\xf3rio"),b(!1);return}if(!(0,h.oH)(e.email)){C("Email inv\xe1lido"),b(!1);return}if(!e.phone.trim()){C("Telefone \xe9 obrigat\xf3rio"),b(!1);return}if(!(0,h.a$)(e.phone)){C("Telefone inv\xe1lido"),b(!1);return}if(!e.cpf.trim()){C("CPF \xe9 obrigat\xf3rio"),b(!1);return}if(!(0,h.pM)(e.cpf)){C("CPF inv\xe1lido"),b(!1);return}if(e.password!==e.confirmPassword){C("As senhas n\xe3o coincidem"),b(!1);return}let t=(0,h.uo)(e.password);if(!t.isValid){C(t.message||"Senha inv\xe1lida"),b(!1);return}try{let{error:r}=await k(e.email,e.password,{full_name:e.fullName,phone:e.phone,cpf:e.cpf.replace(/[^\d]/g,"")});r?(console.error("Erro no cadastro:",r),C(r.message||"Erro ao criar conta"),b(!1)):(console.log("Cadastro realizado com sucesso, redirecionando..."),j(!0),setTimeout(()=>{console.log("Executando redirecionamento..."),_.push("/auth/login?message=Conta criada com sucesso! Verifique seu email para confirmar.")},1e3))}catch(e){C("Erro interno do servidor"),b(!1)}};return(0,a.jsxs)("div",{className:"min-h-screen bg-gray-900 flex flex-col justify-center py-12 sm:px-6 lg:px-8",children:[(0,a.jsxs)("div",{className:"sm:mx-auto sm:w-full sm:max-w-md",children:[(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsx)(n.default,{href:"/",className:"flex items-center",children:(0,a.jsx)("div",{className:"w-12 h-12 bg-primary-500 rounded-full flex items-center justify-center",children:(0,a.jsx)("span",{className:"font-bold text-black text-lg",children:"AL"})})})}),(0,a.jsx)("h2",{className:"mt-6 text-center text-3xl font-bold text-white",children:"Crie sua conta"}),(0,a.jsxs)("p",{className:"mt-2 text-center text-sm text-gray-300",children:["Ou"," ",(0,a.jsx)(n.default,{href:"/auth/login",className:"font-medium text-primary-400 hover:text-primary-300",children:"entre na sua conta existente"})]})]}),(0,a.jsx)("div",{className:"mt-8 sm:mx-auto sm:w-full sm:max-w-md",children:(0,a.jsx)("div",{className:"bg-gray-800 py-8 px-4 shadow sm:rounded-lg sm:px-10",children:(0,a.jsxs)("form",{className:"space-y-6",onSubmit:S,children:[N&&(0,a.jsx)("div",{className:"bg-red-900 border border-red-700 text-red-200 px-4 py-3 rounded-md text-sm",children:N}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"fullName",className:"block text-sm font-medium text-gray-300",children:"Nome Completo"}),(0,a.jsxs)("div",{className:"mt-1 relative",children:[(0,a.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,a.jsx)(l.Z,{className:"h-5 w-5 text-gray-400"})}),(0,a.jsx)("input",{id:"fullName",name:"fullName",type:"text",autoComplete:"name",required:!0,value:e.fullName,onChange:E,className:"appearance-none block w-full pl-10 pr-3 py-2 bg-gray-700 border border-gray-600 text-white rounded-md placeholder-gray-400 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm",placeholder:"Seu nome completo"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-300",children:"Email"}),(0,a.jsxs)("div",{className:"mt-1 relative",children:[(0,a.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,a.jsx)(i.Z,{className:"h-5 w-5 text-gray-400"})}),(0,a.jsx)("input",{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,value:e.email,onChange:E,className:"appearance-none block w-full pl-10 pr-3 py-2 bg-gray-700 border border-gray-600 text-white rounded-md placeholder-gray-400 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm",placeholder:"seu@email.com"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-300",children:"Telefone"}),(0,a.jsxs)("div",{className:"mt-1 relative",children:[(0,a.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,a.jsx)(c.Z,{className:"h-5 w-5 text-gray-400"})}),(0,a.jsx)("input",{id:"phone",name:"phone",type:"tel",autoComplete:"tel",maxLength:15,value:e.phone,onChange:E,className:"appearance-none block w-full pl-10 pr-3 py-2 bg-gray-700 border border-gray-600 text-white rounded-md placeholder-gray-400 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm",placeholder:"(11) 99999-9999"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"cpf",className:"block text-sm font-medium text-gray-300",children:"CPF"}),(0,a.jsx)("div",{className:"mt-1",children:(0,a.jsx)("input",{id:"cpf",name:"cpf",type:"text",maxLength:14,value:e.cpf,onChange:E,className:"appearance-none block w-full px-3 py-2 bg-gray-700 border border-gray-600 text-white rounded-md placeholder-gray-400 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm",placeholder:"000.000.000-00"})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-300",children:"Senha"}),(0,a.jsxs)("div",{className:"mt-1 relative",children:[(0,a.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,a.jsx)(u.Z,{className:"h-5 w-5 text-gray-400"})}),(0,a.jsx)("input",{id:"password",name:"password",type:t?"text":"password",autoComplete:"new-password",required:!0,value:e.password,onChange:E,className:"appearance-none block w-full pl-10 pr-10 py-2 bg-gray-700 border border-gray-600 text-white rounded-md placeholder-gray-400 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm",placeholder:"M\xednimo 6 caracteres"}),(0,a.jsx)("button",{type:"button",className:"absolute inset-y-0 right-0 pr-3 flex items-center",onClick:()=>x(!t),children:t?(0,a.jsx)(d.Z,{className:"h-5 w-5 text-gray-400"}):(0,a.jsx)(m.Z,{className:"h-5 w-5 text-gray-400"})})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-300",children:"Confirmar Senha"}),(0,a.jsxs)("div",{className:"mt-1 relative",children:[(0,a.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,a.jsx)(u.Z,{className:"h-5 w-5 text-gray-400"})}),(0,a.jsx)("input",{id:"confirmPassword",name:"confirmPassword",type:g?"text":"password",autoComplete:"new-password",required:!0,value:e.confirmPassword,onChange:E,className:"appearance-none block w-full pl-10 pr-10 py-2 bg-gray-700 border border-gray-600 text-white rounded-md placeholder-gray-400 focus:outline-none focus:ring-primary-500 focus:border-primary-500 sm:text-sm",placeholder:"Confirme sua senha"}),(0,a.jsx)("button",{type:"button",className:"absolute inset-y-0 right-0 pr-3 flex items-center",onClick:()=>y(!g),children:g?(0,a.jsx)(d.Z,{className:"h-5 w-5 text-gray-400"}):(0,a.jsx)(m.Z,{className:"h-5 w-5 text-gray-400"})})]})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("input",{id:"agree-terms",name:"agree-terms",type:"checkbox",required:!0,className:"h-4 w-4 text-primary-400 focus:ring-primary-500 border-gray-300 rounded"}),(0,a.jsxs)("label",{htmlFor:"agree-terms",className:"ml-2 block text-sm text-gray-300",children:["Eu concordo com os"," ",(0,a.jsx)(n.default,{href:"/terms",className:"text-primary-400 hover:text-primary-300",children:"Termos de Uso"})," ","e"," ",(0,a.jsx)(n.default,{href:"/privacy",className:"text-primary-400 hover:text-primary-300",children:"Pol\xedtica de Privacidade"})]})]}),(0,a.jsx)("div",{children:(0,a.jsx)("button",{type:"submit",disabled:v||w,className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-black bg-primary-500 hover:bg-primary-400 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 disabled:opacity-50 disabled:cursor-not-allowed",children:v?"Criando conta...":w?"Redirecionando...":"Criar conta"})})]})})}),(0,a.jsx)("div",{className:"mt-8 text-center",children:(0,a.jsxs)(n.default,{href:"/",className:"inline-flex items-center text-sm text-gray-300 hover:text-white",children:[(0,a.jsx)(f.Z,{className:"w-4 h-4 mr-1"}),"Voltar para o site"]})})]})}},6281:function(e,r,t){"use strict";t.d(r,{AuthProvider:function(){return l},a:function(){return i}});var a=t(7437),s=t(2265),o=t(9203);let n=(0,s.createContext)(void 0);function l(e){let{children:r}=e,[t,l]=(0,s.useState)(null),[i,c]=(0,s.useState)(null),[u,d]=(0,s.useState)(null),[m,f]=(0,s.useState)(!0),p=(0,o.e)();(0,s.useEffect)(()=>{(async()=>{var e;let{data:{session:r}}=await p.auth.getSession();d(r),l(null!==(e=null==r?void 0:r.user)&&void 0!==e?e:null),(null==r?void 0:r.user)&&await h(r.user.id),f(!1)})();let{data:{subscription:e}}=p.auth.onAuthStateChange(async(e,r)=>{var t;d(r),l(null!==(t=null==r?void 0:r.user)&&void 0!==t?t:null),(null==r?void 0:r.user)?await h(r.user.id):c(null),f(!1)});return()=>e.unsubscribe()},[]);let h=async e=>{try{let{data:r,error:a}=await p.from("profiles").select("*").eq("id",e).single();if(a){console.error("Erro ao buscar perfil:",a),console.log("Tentando criar perfil para usu\xe1rio:",e);let{data:r,error:s}=await p.from("profiles").insert({id:e,email:(null==t?void 0:t.email)||"usuario@exemplo.com",full_name:"Usu\xe1rio",user_type:"cliente"}).select().single();if(s){console.error("Erro ao criar perfil:",s);let r={id:e,email:(null==t?void 0:t.email)||"usuario@exemplo.com",full_name:"Usu\xe1rio",phone:null,cpf:null,birth_date:null,user_type:"cliente",avatar_url:null,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};c(r)}else console.log("Perfil criado com sucesso:",r),c(r)}else console.log("Perfil encontrado:",r),c(r);let{data:s,error:o}=await p.from("user_roles").select("role").eq("user_id",e);if(o){console.error("Erro ao buscar roles:",o),c(r);return}let n=r.user_type||"cliente";if(s&&s.length>0){let e=s.map(e=>e.role);e.includes("admin")?n="admin":e.includes("vendedor")&&(n="vendedor")}"00000000-0000-0000-0000-000000000001"===e&&(n="admin",console.log("\uD83D\uDD27 Usu\xe1rio admin detectado via fallback"));let l={...r,user_type:n};c(l)}catch(r){console.error("Erro ao buscar perfil:",r),c({id:e,email:"usuario@exemplo.com",full_name:"Usu\xe1rio",phone:null,cpf:null,birth_date:null,user_type:"cliente",avatar_url:null,created_at:new Date().toISOString(),updated_at:new Date().toISOString()})}},x=async(e,r,t)=>{try{let{data:a}=await p.auth.getUser(),{data:s}=await p.from("profiles").select("email").eq("email",e).single();if(s)return{error:{message:"Este email j\xe1 est\xe1 cadastrado"}};if(t.cpf){let{data:e}=await p.from("profiles").select("cpf").eq("cpf",t.cpf).single();if(e)return{error:{message:"Este CPF j\xe1 est\xe1 cadastrado"}}}console.log("Criando usu\xe1rio no Supabase Auth...");let{data:o,error:n}=await p.auth.signUp({email:e,password:r,options:{data:{full_name:t.full_name,phone:t.phone}}});if(console.log("Resultado da cria\xe7\xe3o do usu\xe1rio:",{data:o,error:n}),n){let e=n.message;return n.message.includes("already registered")||n.message.includes("User already registered")?e="Este email j\xe1 est\xe1 cadastrado":n.message.includes("Invalid email")?e="Email inv\xe1lido":n.message.includes("Password should be at least")?e="A senha deve ter pelo menos 6 caracteres":n.message.includes("Unable to validate email address")&&(e="N\xe3o foi poss\xedvel validar o email"),{error:{...n,message:e}}}if(o.user){console.log("Criando perfil para usu\xe1rio:",o.user.id),console.log("Dados do perfil:",{id:o.user.id,email:o.user.email,full_name:t.full_name,phone:t.phone,cpf:t.cpf,birth_date:t.birth_date,user_type:"cliente"});let{data:e,error:r}=await p.from("profiles").insert({id:o.user.id,email:o.user.email,full_name:t.full_name,phone:t.phone,cpf:t.cpf,birth_date:t.birth_date,user_type:"cliente"}).select();if(r)return console.error("Erro ao criar perfil:",r),console.error("Detalhes do erro:",{code:r.code,message:r.message,details:r.details,hint:r.hint}),await p.auth.admin.deleteUser(o.user.id),{error:{message:"Erro ao criar perfil do usu\xe1rio"}};console.log("Perfil criado com sucesso:",e)}return console.log("Cadastro finalizado com sucesso, retornando sucesso"),{error:null}}catch(e){return console.error("Erro no signUp:",e),{error:{message:"Erro interno do servidor"}}}},g=async(e,r)=>{try{var t;console.log("Tentando fazer login para:",e);let{data:a,error:s}=await p.auth.signInWithPassword({email:e,password:r});if(s)return console.error("Erro no login:",s),{error:s};return console.log("Login realizado com sucesso:",null===(t=a.user)||void 0===t?void 0:t.email),{error:null}}catch(e){return console.error("Erro no catch do login:",e),{error:e}}},y=async()=>{try{await p.auth.signOut()}catch(e){console.error("Erro ao fazer logout:",e)}},v=async e=>{if(!t)return{error:Error("Usu\xe1rio n\xe3o autenticado")};try{let{error:r}=await p.from("profiles").update(e).eq("id",t.id);if(r)return{error:r};return c(r=>r?{...r,...e}:null),{error:null}}catch(e){return{error:e}}};return(0,a.jsx)(n.Provider,{value:{user:t,profile:i,session:u,loading:m,signUp:x,signIn:g,signOut:y,updateProfile:v},children:r})}function i(){let e=(0,s.useContext)(n);if(void 0===e)throw Error("useAuth deve ser usado dentro de um AuthProvider");return e}},9203:function(e,r,t){"use strict";t.d(r,{e:function(){return s}});var a=t(7272);function s(){return(0,a.createBrowserClient)("https://nzrzgtwhgousnnvxjyhf.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im56cnpndHdoZ291c25udnhqeWhmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk2ODc1OTAsImV4cCI6MjA3NTI2MzU5MH0.RxeZfgwMfUAr6iGDCb4gsB_lDLYYgyWj70hCaC3CE7o")}},1384:function(e,r,t){"use strict";t.d(r,{CN:function(){return o},Cz:function(){return s},a$:function(){return i},oH:function(){return n},pM:function(){return a},uo:function(){return l}});let a=e=>{if(11!==(e=e.replace(/[^\d]/g,"")).length||/^(\d)\1{10}$/.test(e))return!1;let r=0;for(let t=0;t<9;t++)r+=parseInt(e.charAt(t))*(10-t);let t=10*r%11;if((10===t||11===t)&&(t=0),t!==parseInt(e.charAt(9)))return!1;r=0;for(let t=0;t<10;t++)r+=parseInt(e.charAt(t))*(11-t);return(10==(t=10*r%11)||11===t)&&(t=0),t===parseInt(e.charAt(10))},s=e=>{let r=e.replace(/[^\d]/g,"");return r.length<=3?r:r.length<=6?"".concat(r.slice(0,3),".").concat(r.slice(3)):r.length<=9?"".concat(r.slice(0,3),".").concat(r.slice(3,6),".").concat(r.slice(6)):"".concat(r.slice(0,3),".").concat(r.slice(3,6),".").concat(r.slice(6,9),"-").concat(r.slice(9,11))},o=e=>{let r=e.replace(/[^\d]/g,"");return r.length<=2?r:r.length<=7?"(".concat(r.slice(0,2),") ").concat(r.slice(2)):"(".concat(r.slice(0,2),") ").concat(r.slice(2,7),"-").concat(r.slice(7,11))},n=e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),l=e=>e.length<6?{isValid:!1,message:"A senha deve ter pelo menos 6 caracteres"}:e.length>128?{isValid:!1,message:"A senha deve ter no m\xe1ximo 128 caracteres"}:{isValid:!0},i=e=>{let r=e.replace(/[^\d]/g,"");return 10===r.length||11===r.length}},2660:function(e,r,t){"use strict";t.d(r,{Z:function(){return a}});let a=(0,t(9763).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},7769:function(e,r,t){"use strict";t.d(r,{Z:function(){return a}});let a=(0,t(9763).Z)("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]])},2208:function(e,r,t){"use strict";t.d(r,{Z:function(){return a}});let a=(0,t(9763).Z)("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},6337:function(e,r,t){"use strict";t.d(r,{Z:function(){return a}});let a=(0,t(9763).Z)("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]])},9345:function(e,r,t){"use strict";t.d(r,{Z:function(){return a}});let a=(0,t(9763).Z)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]])},3041:function(e,r,t){"use strict";t.d(r,{Z:function(){return a}});let a=(0,t(9763).Z)("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]])},2369:function(e,r,t){"use strict";t.d(r,{Z:function(){return a}});let a=(0,t(9763).Z)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},7648:function(e,r,t){"use strict";t.d(r,{default:function(){return s.a}});var a=t(2972),s=t.n(a)},9376:function(e,r,t){"use strict";var a=t(5475);t.o(a,"notFound")&&t.d(r,{notFound:function(){return a.notFound}}),t.o(a,"useRouter")&&t.d(r,{useRouter:function(){return a.useRouter}}),t.o(a,"useSearchParams")&&t.d(r,{useSearchParams:function(){return a.useSearchParams}})}},function(e){e.O(0,[972,99,971,117,744],function(){return e(e.s=4326)}),_N_E=e.O()}]);