(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[91],{2148:function(e,r,a){Promise.resolve().then(a.bind(a,2307))},2307:function(e,r,a){"use strict";a.r(r),a.d(r,{default:function(){return l}});var t=a(7437),s=a(6281),o=a(9376),n=a(7692);function l(e){let{children:r}=e,{user:a,profile:l,signOut:i,loading:u}=(0,s.a)(),c=(0,o.useRouter)(),d=async()=>{await i(),c.push("/")};return u?(0,t.jsx)("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center",children:(0,t.jsx)("div",{className:"text-white text-xl",children:"Carregando..."})}):a?(0,t.jsxs)("div",{className:"min-h-screen bg-gray-900",children:[(0,t.jsx)("header",{className:"bg-gray-800 border-b border-gray-700",children:(0,t.jsxs)("div",{className:"flex items-center justify-between px-4 py-3",children:[(0,t.jsx)("h1",{className:"text-xl font-semibold text-white",children:"Painel Administrativo"}),(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,t.jsx)("span",{className:"text-gray-300",children:(null==l?void 0:l.full_name)||a.email}),(0,t.jsxs)("button",{onClick:d,className:"flex items-center space-x-2 text-gray-300 hover:text-white",children:[(0,t.jsx)(n.Z,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:"Sair"})]})]})]})}),(0,t.jsx)("main",{className:"p-6",children:r})]}):(0,t.jsx)("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"text-white text-xl mb-4",children:"Acesso Negado"}),(0,t.jsx)("div",{className:"text-gray-300 mb-6",children:"Voc\xea precisa estar logado para acessar esta \xe1rea."}),(0,t.jsx)("button",{onClick:()=>c.push("/auth/login"),className:"bg-primary-500 text-black px-4 py-2 rounded hover:bg-primary-600 transition-colors",children:"Fazer Login"})]})})}},6281:function(e,r,a){"use strict";a.d(r,{AuthProvider:function(){return l},a:function(){return i}});var t=a(7437),s=a(2265),o=a(9203);let n=(0,s.createContext)(void 0);function l(e){let{children:r}=e,[a,l]=(0,s.useState)(null),[i,u]=(0,s.useState)(null),[c,d]=(0,s.useState)(null),[m,f]=(0,s.useState)(!0),h=(0,o.e)();(0,s.useEffect)(()=>{(async()=>{var e;let{data:{session:r}}=await h.auth.getSession();d(r),l(null!==(e=null==r?void 0:r.user)&&void 0!==e?e:null),(null==r?void 0:r.user)&&await p(r.user.id),f(!1)})();let{data:{subscription:e}}=h.auth.onAuthStateChange(async(e,r)=>{var a;d(r),l(null!==(a=null==r?void 0:r.user)&&void 0!==a?a:null),(null==r?void 0:r.user)?await p(r.user.id):u(null),f(!1)});return()=>e.unsubscribe()},[]);let p=async e=>{try{let{data:r,error:t}=await h.from("profiles").select("*").eq("id",e).single();if(t){console.error("Erro ao buscar perfil:",t),console.log("Tentando criar perfil para usu\xe1rio:",e);let{data:r,error:s}=await h.from("profiles").insert({id:e,email:(null==a?void 0:a.email)||"usuario@exemplo.com",full_name:"Usu\xe1rio",user_type:"cliente"}).select().single();if(s){console.error("Erro ao criar perfil:",s);let r={id:e,email:(null==a?void 0:a.email)||"usuario@exemplo.com",full_name:"Usu\xe1rio",phone:null,cpf:null,birth_date:null,user_type:"cliente",avatar_url:null,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};u(r)}else console.log("Perfil criado com sucesso:",r),u(r)}else console.log("Perfil encontrado:",r),u(r);let{data:s,error:o}=await h.from("user_roles").select("role").eq("user_id",e);if(o){console.error("Erro ao buscar roles:",o),u(r);return}let n=r.user_type||"cliente";if(s&&s.length>0){let e=s.map(e=>e.role);e.includes("admin")?n="admin":e.includes("vendedor")&&(n="vendedor")}"00000000-0000-0000-0000-000000000001"===e&&(n="admin",console.log("\uD83D\uDD27 Usu\xe1rio admin detectado via fallback"));let l={...r,user_type:n};u(l)}catch(r){console.error("Erro ao buscar perfil:",r),u({id:e,email:"usuario@exemplo.com",full_name:"Usu\xe1rio",phone:null,cpf:null,birth_date:null,user_type:"cliente",avatar_url:null,created_at:new Date().toISOString(),updated_at:new Date().toISOString()})}},g=async(e,r,a)=>{try{let{data:t}=await h.auth.getUser(),{data:s}=await h.from("profiles").select("email").eq("email",e).single();if(s)return{error:{message:"Este email j\xe1 est\xe1 cadastrado"}};if(a.cpf){let{data:e}=await h.from("profiles").select("cpf").eq("cpf",a.cpf).single();if(e)return{error:{message:"Este CPF j\xe1 est\xe1 cadastrado"}}}console.log("Criando usu\xe1rio no Supabase Auth...");let{data:o,error:n}=await h.auth.signUp({email:e,password:r,options:{data:{full_name:a.full_name,phone:a.phone}}});if(console.log("Resultado da cria\xe7\xe3o do usu\xe1rio:",{data:o,error:n}),n){let e=n.message;return n.message.includes("already registered")||n.message.includes("User already registered")?e="Este email j\xe1 est\xe1 cadastrado":n.message.includes("Invalid email")?e="Email inv\xe1lido":n.message.includes("Password should be at least")?e="A senha deve ter pelo menos 6 caracteres":n.message.includes("Unable to validate email address")&&(e="N\xe3o foi poss\xedvel validar o email"),{error:{...n,message:e}}}if(o.user){console.log("Criando perfil para usu\xe1rio:",o.user.id),console.log("Dados do perfil:",{id:o.user.id,email:o.user.email,full_name:a.full_name,phone:a.phone,cpf:a.cpf,birth_date:a.birth_date,user_type:"cliente"});let{data:e,error:r}=await h.from("profiles").insert({id:o.user.id,email:o.user.email,full_name:a.full_name,phone:a.phone,cpf:a.cpf,birth_date:a.birth_date,user_type:"cliente"}).select();if(r)return console.error("Erro ao criar perfil:",r),console.error("Detalhes do erro:",{code:r.code,message:r.message,details:r.details,hint:r.hint}),await h.auth.admin.deleteUser(o.user.id),{error:{message:"Erro ao criar perfil do usu\xe1rio"}};console.log("Perfil criado com sucesso:",e)}return console.log("Cadastro finalizado com sucesso, retornando sucesso"),{error:null}}catch(e){return console.error("Erro no signUp:",e),{error:{message:"Erro interno do servidor"}}}},v=async(e,r)=>{try{var a;console.log("Tentando fazer login para:",e);let{data:t,error:s}=await h.auth.signInWithPassword({email:e,password:r});if(s)return console.error("Erro no login:",s),{error:s};return console.log("Login realizado com sucesso:",null===(a=t.user)||void 0===a?void 0:a.email),{error:null}}catch(e){return console.error("Erro no catch do login:",e),{error:e}}},x=async()=>{try{await h.auth.signOut()}catch(e){console.error("Erro ao fazer logout:",e)}},y=async e=>{if(!a)return{error:Error("Usu\xe1rio n\xe3o autenticado")};try{let{error:r}=await h.from("profiles").update(e).eq("id",a.id);if(r)return{error:r};return u(r=>r?{...r,...e}:null),{error:null}}catch(e){return{error:e}}};return(0,t.jsx)(n.Provider,{value:{user:a,profile:i,session:c,loading:m,signUp:g,signIn:v,signOut:x,updateProfile:y},children:r})}function i(){let e=(0,s.useContext)(n);if(void 0===e)throw Error("useAuth deve ser usado dentro de um AuthProvider");return e}},9203:function(e,r,a){"use strict";a.d(r,{e:function(){return s}});var t=a(7272);function s(){return(0,t.createBrowserClient)("https://nzrzgtwhgousnnvxjyhf.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im56cnpndHdoZ291c25udnhqeWhmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk2ODc1OTAsImV4cCI6MjA3NTI2MzU5MH0.RxeZfgwMfUAr6iGDCb4gsB_lDLYYgyWj70hCaC3CE7o")}},7692:function(e,r,a){"use strict";a.d(r,{Z:function(){return t}});let t=(0,a(9763).Z)("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]])},9376:function(e,r,a){"use strict";var t=a(5475);a.o(t,"notFound")&&a.d(r,{notFound:function(){return t.notFound}}),a.o(t,"useRouter")&&a.d(r,{useRouter:function(){return t.useRouter}}),a.o(t,"useSearchParams")&&a.d(r,{useSearchParams:function(){return t.useSearchParams}})}},function(e){e.O(0,[99,971,117,744],function(){return e(e.s=2148)}),_N_E=e.O()}]);