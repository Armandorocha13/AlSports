"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[527],{7527:function(e,t,a){a.d(t,{CartProvider:function(){return m},j:function(){return h}});var n=a(7437),o=a(2265);let r={width:30,height:40,length:2,weight:.3,insurance_value:50};class i{static getInstance(){return i.instance||(i.instance=new i),i.instance}async calculateShipping(e,t,a){if(!this.apiKey)return console.warn("Superfrete API key n\xe3o configurada"),this.getFallbackShipping();try{let n={from:{postal_code:e.replace(/\D/g,"")},to:{postal_code:t.replace(/\D/g,"")},products:a.map(e=>({id:e.id,width:r.width,height:r.height,length:r.length,weight:r.weight,insurance_value:r.insurance_value,quantity:e.quantity}))},o=await fetch("".concat(this.baseUrl,"/shipment/calculate"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.apiKey),"User-Agent":"AlSports/1.0"},body:JSON.stringify(n)});if(!o.ok)throw Error("Erro na API Superfrete: ".concat(o.status));return(await o.json()).map(e=>({id:e.id,name:e.name,price:e.price,delivery_time:e.delivery_time,delivery_range:e.delivery_range,company:e.company}))}catch(e){return console.error("Erro ao calcular frete:",e),this.getFallbackShipping()}}getFallbackShipping(){return[{id:"pac",name:"PAC",price:15,delivery_time:5,delivery_range:"5-7 dias \xfateis",company:{id:1,name:"Correios",picture:""}},{id:"sedex",name:"SEDEX",price:25,delivery_time:3,delivery_range:"3-5 dias \xfateis",company:{id:1,name:"Correios",picture:""}}]}calculateShippingByQuantity(e){return e>=50?{method:"transportadora",cost:0,estimatedDays:"5-7 dias \xfateis",minQuantity:50}:e>=20?{method:"super-frete",cost:8,estimatedDays:"3-5 dias \xfateis",minQuantity:1}:e>=10?{method:"super-frete",cost:12,estimatedDays:"3-5 dias \xfateis",minQuantity:1}:{method:"super-frete",cost:15,estimatedDays:"3-5 dias \xfateis",minQuantity:1}}calculateTransportadoraPrice(e){return e>=50?0:e>=30?15:e>=20?25:-1}getTransportadoraPricing(e){let t=this.calculateTransportadoraPrice(e);if(-1===t){let t=e<20?20:e<30?30:50;return{available:!1,price:0,description:"Adicione mais ".concat(t-e," pe\xe7as para ter acesso \xe0 transportadora"),nextThreshold:{pieces:t,price:20===t?25:30===t?15:0}}}return 0===t?{available:!0,price:0,description:"Frete gr\xe1tis para pedidos com 50+ pe\xe7as"}:{available:!0,price:t,description:"R$ ".concat(t.toFixed(2).replace(".",",")," para pedidos com ").concat(e," pe\xe7as")}}constructor(){this.baseUrl="https://api.superfrete.com",this.apiKey="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE3NjA5ODUyNDIsInN1YiI6IlBIc0VYRTh4ckNZdE1QUUlWcXdmSGZXSmNBbzIifQ.Csmlr1Iyx61wqru_p7GYaejS-LNPxEwp6FPG92P4Wak"}}let c=i.getInstance();class s{static getInstance(){return s.instance||(s.instance=new s),s.instance}generateOrderCode(){Date.now();let e=Math.random().toString(36).substring(2,8).toUpperCase(),t=new Date,a=t.getFullYear().toString().slice(-2),n=(t.getMonth()+1).toString().padStart(2,"0"),o=t.getDate().toString().padStart(2,"0");return"ALS".concat(a).concat(n).concat(o,"-").concat(e)}generateOrderId(){return"order_".concat(Date.now(),"_").concat(Math.random().toString(36).substring(2,15))}createOrder(e){let t=this.generateOrderCode();return{id:this.generateOrderId(),code:t,createdAt:new Date,status:"pending",totalItems:e.totalItems||0,totalPieces:e.totalPieces||0,subtotal:e.subtotal||0,shipping:e.shipping||0,total:e.total||0,shippingMethod:e.shippingMethod||"super-frete",customerInfo:e.customerInfo,shippingAddress:e.shippingAddress,paymentMethod:e.paymentMethod,notes:e.notes,items:e.items||[]}}formatOrderForWhatsApp(e){let t="\uD83D\uDED2 *NOVO PEDIDO - ".concat(e.code,"*\n\n");return t+="\uD83D\uDCCB *RESUMO DO PEDIDO:*\n"+"• Total de itens: ".concat(e.totalItems,"\n")+"• Total de pe\xe7as: ".concat(e.totalPieces,"\n")+"• Subtotal: R$ ".concat(e.subtotal.toFixed(2),"\n")+"• Frete: R$ ".concat(e.shipping.toFixed(2),"\n")+"• *TOTAL: R$ ".concat(e.total.toFixed(2),"*\n\n")+"\uD83D\uDE9A *FRETE:*\n","transportadora"===e.shippingMethod?t+="• M\xe9todo: Transportadora (GR\xc1TIS)\n• Prazo: 5-7 dias \xfateis\n":t+="• M\xe9todo: Super Frete\n"+"• Valor: R$ ".concat(e.shipping.toFixed(2),"\n")+"• Prazo: 3-5 dias \xfateis\n",t+="\n\uD83D\uDCE6 *ITENS DO PEDIDO:*\n",e.items.forEach((e,a)=>{t+="".concat(a+1,". ").concat(e.productName,"\n")+"   • Tamanho: ".concat(e.size,"\n"),e.color&&(t+="   • Cor: ".concat(e.color,"\n")),t+="   • Quantidade: ".concat(e.quantity,"x\n")+"   • Pre\xe7o unit.: R$ ".concat(e.unitPrice.toFixed(2),"\n")+"   • Subtotal: R$ ".concat(e.totalPrice.toFixed(2),"\n\n")}),e.customerInfo&&(t+="\n\uD83D\uDC64 *DADOS DO CLIENTE:*\n"+"• Nome: ".concat(e.customerInfo.name,"\n")+"• Email: ".concat(e.customerInfo.email,"\n")+"• Telefone: ".concat(e.customerInfo.phone,"\n")),e.shippingAddress&&(t+="\n\uD83D\uDCCD *ENDERE\xc7O DE ENTREGA:*\n"+"• ".concat(e.shippingAddress.name,"\n")+"• ".concat(e.shippingAddress.street,", ").concat(e.shippingAddress.number),e.shippingAddress.complement&&(t+=", ".concat(e.shippingAddress.complement)),t+="\n"+"• ".concat(e.shippingAddress.neighborhood,"\n")+"• ".concat(e.shippingAddress.city,"/").concat(e.shippingAddress.state,"\n")+"• CEP: ".concat(e.shippingAddress.zip_code,"\n")),e.paymentMethod&&(t+="\n\uD83D\uDCB3 *FORMA DE PAGAMENTO:*\n"+"• ".concat(this.formatPaymentMethod(e.paymentMethod),"\n")),e.notes&&(t+="\n\uD83D\uDCDD *OBSERVA\xc7\xd5ES:*\n"+"• ".concat(e.notes,"\n")),t+="\n✅ *CONFIRMA\xc7\xc3O:*\n• Cliente confirma o pedido\n• Dados de entrega corretos\n• Forma de pagamento escolhida\n\n\uD83D\uDCDE *INSTRU\xc7\xd5ES PARA O CLIENTE:*\n"+"• Anote o n\xfamero do pedido: *".concat(e.code,"*\n")+"• Envie o comprovante de pagamento junto com este n\xfamero\n• Aguarde a confirma\xe7\xe3o do pagamento\n\n"+"_Pedido gerado em ".concat(e.createdAt.toLocaleString("pt-BR"),"_")}formatPaymentMethod(e){return({pix:"PIX",cartao_credito:"Cart\xe3o de Cr\xe9dito",cartao_debito:"Cart\xe3o de D\xe9bito",boleto:"Boleto Banc\xe1rio",transferencia:"Transfer\xeancia Banc\xe1ria"})[e]||e}generateWhatsAppUrl(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"5521990708854",a=this.formatOrderForWhatsApp(e);return"https://wa.me/".concat(t,"?text=").concat(encodeURIComponent(a))}}let d=s.getInstance();class l{static calculateItemDiscount(e,t){let a=e.price,n=e.wholesalePrice,o=null;if(e.priceRanges&&e.priceRanges.length>0){let a=e.priceRanges.find(e=>t>=e.min);a&&(n=a.price,o=a)}let r=a-n;return{originalPrice:a,discountedPrice:n,discountAmount:r,discountPercentage:Math.round(r/a*100),priceRange:o||void 0}}static calculateCartDiscountSummary(e){let t=0,a=0,n=[];for(let o of e){let e=this.calculateItemDiscount(o.product,o.quantity),r=e.originalPrice*o.quantity,i=e.discountedPrice*o.quantity,c=r-i;t+=r,a+=i,n.push({productId:o.product.id,productName:o.product.name,quantity:o.quantity,originalPrice:r,discountedPrice:i,savings:c,savingsPercentage:e.discountPercentage})}let o=t-a,r=t>0?Math.round(o/t*100):0;return{totalOriginalPrice:t,totalDiscountedPrice:a,totalSavings:o,totalSavingsPercentage:r,items:n}}static getApplicablePriceRange(e,t){return e.priceRanges&&0!==e.priceRanges.length?e.priceRanges.find(e=>t>=e.min):null}static getNextDiscountThreshold(e,t){if(!e.priceRanges||0===e.priceRanges.length)return null;let a=[...e.priceRanges].sort((e,t)=>e.min-t.min).find(e=>e.min>t);if(a){let n=a.min-t,o=this.calculateItemDiscount(e,t).discountedPrice,r=a.price,i=o-r,c=i*a.min;return{neededQuantity:n,nextPrice:r,savingsPerUnit:i,totalSavings:c,range:a}}return null}static formatCurrency(e){return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(e)}static formatPercentage(e){return"".concat(e,"%")}}let p=(0,a(9203).e)(),u=(0,o.createContext)(void 0);function m(e){let{children:t}=e,[a,r]=(0,o.useState)([]),i=(e,t,a)=>{r(n=>n.filter(n=>!(n.product.id===e&&n.selectedSize===t&&n.selectedColor===a)))},s=()=>a.reduce((e,t)=>e+t.quantity,0),m=()=>a.reduce((e,t)=>e+t.quantity,0),h=(e,t)=>{if(!e.priceRanges||0===e.priceRanges.length)return e.wholesalePrice;let a=e.priceRanges.find(e=>t>=e.min);return a?a.price:e.wholesalePrice},g=()=>a.reduce((e,t)=>e+h(t.product,t.quantity)*t.quantity,0),D=()=>{let e=m();return c.calculateShippingByQuantity(e)},y=()=>D().cost,f=()=>g()+y(),I=async(e,t)=>{try{let a={order_number:t.code,customer_name:e.name,customer_email:e.email,customer_phone:e.phone,status:"aguardando_pagamento",subtotal:t.subtotal,shipping_cost:t.shipping,total_amount:t.total,items:t.items,shipping_address:{name:e.name,email:e.email,phone:e.phone,method:t.shippingMethod||"whatsapp"},notes:"Pedido finalizado via WhatsApp - ".concat(t.code),whatsapp_message:"Ol\xe1! Tenho um novo pedido para voc\xea:\n\n*N\xfamero do Pedido:* ".concat(t.code,"\n*Total:* R$ ").concat(t.total.toFixed(2),"\n*Itens:*\n").concat(t.items.map(e=>"- ".concat(e.quantity,"x ").concat(e.productName," (").concat(e.size,") - R$ ").concat(e.totalPrice.toFixed(2))).join("\n"),"\n\nPor favor, aguardo as instru\xe7\xf5es para pagamento e envio do comprovante."),whatsapp_sent_at:new Date().toISOString()};try{let{data:e,error:t}=await p.from("whatsapp_orders").insert([a]).select();if(t)throw console.error("❌ Erro ao salvar em whatsapp_orders:",t),t;return console.log("✅ Pedido salvo na tabela whatsapp_orders:",e[0]),e[0]}catch(e){console.log("⚠️ Tabela whatsapp_orders n\xe3o dispon\xedvel, tentando tabela orders...");try{let e={order_number:a.order_number,customer_name:a.customer_name,customer_email:a.customer_email,total_amount:a.total_amount,shipping_address:a.shipping_address,status:a.status,subtotal:a.subtotal,shipping_cost:a.shipping_cost,discount_amount:0},{data:t,error:n}=await p.from("orders").insert([e]).select();if(n)throw console.error("❌ Erro ao salvar na tabela orders:",n),n;return console.log("✅ Pedido salvo na tabela orders:",t[0]),{...t[0],source:"whatsapp",method:"whatsapp"}}catch(n){console.log("⚠️ Tabela orders n\xe3o dispon\xedvel, salvando no localStorage...");let e={...a,id:"order_".concat(Date.now()),created_at:new Date().toISOString(),method:"whatsapp"},t=JSON.parse(localStorage.getItem("user_orders")||"[]");return t.push(e),localStorage.setItem("user_orders",JSON.stringify(t)),console.log("✅ Pedido salvo no localStorage (fallback final):",e),console.log("\uD83D\uDCCA Total de pedidos no localStorage:",t.length),e}}}catch(e){throw console.error("Erro ao salvar pedido:",e),e}};return(0,n.jsx)(u.Provider,{value:{items:a,addItem:function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3?arguments[3]:void 0;console.log("\uD83D\uDED2 CartContext: Adicionando ao carrinho:",{product:e.name,size:t,quantity:a,color:n}),r(o=>{if(o.find(a=>a.product.id===e.id&&a.selectedSize===t&&a.selectedColor===n))return console.log("\uD83D\uDED2 CartContext: Item existente, atualizando quantidade"),o.map(o=>o.product.id===e.id&&o.selectedSize===t&&o.selectedColor===n?{...o,quantity:o.quantity+a,addedAt:new Date}:o);{console.log("\uD83D\uDED2 CartContext: Novo item adicionado");let r=[...o,{id:"".concat(e.id,"-").concat(t,"-").concat(n||"default","-").concat(Date.now()),product:e,quantity:a,selectedSize:t,selectedColor:n,addedAt:new Date}];return console.log("\uD83D\uDED2 CartContext: Total de itens no carrinho:",r.length),r}})},removeItem:i,updateQuantity:(e,t,a,n)=>{if(a<=0){i(e,t,n);return}r(o=>o.map(o=>o.product.id===e&&o.selectedSize===t&&o.selectedColor===n?{...o,quantity:a,addedAt:new Date}:o))},clearCart:()=>{r([])},getTotalItems:s,getTotalPieces:m,getSubtotal:g,getShippingCost:y,getTotal:f,getItemPrice:h,getShippingInfo:D,canUseTransportadora:()=>m()>=50,getMissingForTransportadora:()=>{let e=50-m();return e>0?e:0},createOrder:(e,t,n,o)=>{let r=D(),i=a.map(e=>({productName:e.product.name,size:e.selectedSize,color:e.selectedColor,quantity:e.quantity,unitPrice:h(e.product,e.quantity),totalPrice:h(e.product,e.quantity)*e.quantity}));return d.createOrder({totalItems:s(),totalPieces:m(),subtotal:g(),shipping:y(),total:f(),shippingMethod:r.method,customerInfo:e,shippingAddress:t,paymentMethod:n,notes:o,items:i})},getCartSummary:()=>({totalItems:s(),totalPieces:m(),subtotal:g(),shipping:y(),total:f(),shippingInfo:D()}),openWhatsAppOrder:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"5521990708854",a=d.generateWhatsAppUrl(e,t);window.open(a,"_blank")},saveOrderToDatabase:I,getDiscountSummary:()=>l.calculateCartDiscountSummary(a),getItemDiscount:(e,t)=>l.calculateItemDiscount(e,t),getNextDiscountThreshold:(e,t)=>l.getNextDiscountThreshold(e,t)},children:t})}function h(){let e=(0,o.useContext)(u);if(void 0===e)throw Error("useCart must be used within a CartProvider");return e}},9203:function(e,t,a){a.d(t,{e:function(){return o}});var n=a(7272);function o(){return(0,n.createBrowserClient)("https://nzrzgtwhgousnnvxjyhf.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im56cnpndHdoZ291c25udnhqeWhmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk2ODc1OTAsImV4cCI6MjA3NTI2MzU5MH0.RxeZfgwMfUAr6iGDCb4gsB_lDLYYgyWj70hCaC3CE7o")}}}]);